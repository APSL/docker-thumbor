version: '2'
services:

  imageserver:
    image: python:3
    ports:
      - "127.0.0.1:8080:8000"
    volumes:
      - ./tests/images/v1:/data
    command: ["python3", "-m",  "http.server", "--directory=/data"]
    networks:
      - app

  thumbor:
    build: thumbor
    image: apsl/thumbor:build
    env_file: .travis.env
    volumes:
      - ./data:/data
    links:
      - redis:redis
      - imageserver:imageserver
    ports:
      - "127.0.0.1:8091:8000"
    networks:
      - app

  nginx:
    build: nginx
    image: apsl/thumbor:nginx-build
    links:
      - thumbor:thumbor
    volumes_from:
      - thumbor:ro
    ports:
      - "127.0.0.1:8097:80"
    hostname: nginx
    networks:
      - app

  redis:
    image: redis:latest
    networks:
      - app

volumes:
  data:
    driver: local

networks:
  app:
    driver: bridge
