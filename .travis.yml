sudo: required
language: ruby
services:
  - docker
script:
  - ls -lah
  - docker-compose up -d
  - docker-compose ps
  - wget http://localhost:8001/unsafe/200x100/www.apsl.net/static/apslweb/img/content/slider/rs-slider4-img15.png
notifications:
  email:
    - gshark@gmail.com
env:
  global:
    - COMMIT=${TRAVIS_COMMIT::8}
    - secure: b1cPzcceliZcXBqs6OkyrLA7RltD10QK5tbqocSyhVlczjSsav8hWycU8430mPiXXRTiMDkvhmaUGZReC9gJ4jtedYVGFWRQSoy59FTpl7Gf4ExnK8W/5NLM50aj3ZO48oBaKybaU3Xc+adrVs0M7EOHclm3RYdB6KAr4AhL4kkpzarHcSZlZGOQ/b2R5IKVA2x23+1xEwgVwWC+6GjD2NIzXI6jlx4UdloUvzfMIeA3N2twMaPUdj08rSIgdrmqK7mKxYZ+9bVvXHuRzJH0ogh+9t5/y4tIdq6tJjEjXWLDpHz1Jh7q/PlFmjRO1W+kT5b5gEYsBue9YlFtTZZDyGB5hY/oaAz2bSizx7tw8m5GPCX/yF7f6l/yUzsm5pBbxzVH2NobF+VHyJYSeBmkB8b1g/LSg5YaGCIqB/WQEk8KdmHwzaSAdrsNAykBxfgZnpifxeaKhHhCjlc0gkbEpzcAjh/7MrryF3liQ/1Woyd+MKYkk34awuCDQTEBeOYUeR3kCsD7ZjbZ3fhZoHbjl6D7HCysKpYoT6iV3UX9jshOAkPlSot3p2aHXPAg808jb8KdFTk71UCjnscy2D462bpp4jENC78OC8m2ZB8dg3LV9dHxySVps+IYBmRl+624Rhqxv6GmpdWN1aosqS2CYfCXg1zk15tQr6FZSqV96B4=
    - secure: Ea9ZPTvtOYqo/+UVFDUdWMpjKGB01XbDdGTfIQlXxtZ+rAFKPiA8wDnBIS8X3nVJvPv8fFl8X08CP95pmKnDrB9Az8hhhhuDnzjGchG+DbX2SuyXeVmPTcGbPyfastTz3A/jf9+VYRWZNpMKlOKN9k2vUNgOqjLH9YgWM8AC3rWVHYVMbV2rO1KM9GERngi4MWj91UQHeJAwDDs4paJrnktV6aSXpkaGkai6nXieu0pdVNbOVqnEI0YdGydslnflcZa5XZHUz9SdS7EPR2ZEohArD0kVqNr62yMd23ucH8J2xym8fYR6D8OYjroxI8dK7DaXLPs5UxjgAyK+lh+rbdeArMEJQ3Ikkbt2qzcGTGfqd+vTBbuBLFgRrw8vd4z7PPYcp+iTGTtRo6RA3A0i+8siAVwQh0iGxTCHVloLKOs3K2VZzsg9Ta0qO7YlrXYs+CNtcwzynjbHdkiiq25xGAQYCIzXJrfg4HVY3mvTvUmf0b8enPl+gC0Be0NijJla+lQmaod6dv+Ds4URqWhA7oGfST1TDfiWaQYhuTrRBnSqRN//iiDXAWdXWPtinpW73mHPJps+S6/0CNTtKONi8JfFXaxcr32CjxhY/iSdsu+FQTZg54bRhdYMgeyo2/YbTOKckxm/fyfy07i7ZZXViylAN7G//49d0l672alyPlA=
    - secure: Lsp2kQga6uMolVwcCQh3aCEtOIzJZHmC1PzZCBXtDusiZGwjz6Y8VgOsY4FmtsgyFrwbBw6rz4DGSWilVxs2vxk4jqStkpXA4s/LSaZhMYsDZPHjN1AoOc49U9GvTUrjyQNXW5lSvGKlCUQtSh5IH2SXyPg1BscIfi0Pp9uRBRdPoRDchjHLyS30Vz1DfcZqPIb/G7SyQmKGSHc/37pEipf4LL2NBI8lJO5lohaBEXSl8aY2G2t454hQJ1NKjOSP5ig/CqoivGQeIgwq3j9BYEx+iNXXWIhgY4PEVZtJquW/yAc0Yim1i04qTLsSzYMHbRfVw71R+KL4LXL9OJbTATmuEBUJqcOlJNCz90vWS2A2nYlfzQJgiocRlOh5CTwtfL4PZqa3INf7D+mf545eRhnaRThXDtyBUOYRwlSeTyPyIunI+Rnre7uJA81ByfdUoNxCIQiaXIKru9L1THo/7uSu0kXbodYhrBbWsJy7OvgY+VsqEkPUpRzT/8Wue5Fezy0TzZWv8J0uOdc66VcT9iuNK9I/Y5ttTNi38bFBj7LXf6K4JV8qL+ONofS0x0DiW31H+5NCeOTbp0tOrZZ8Qq2X2odKXkpx4S7KJEMh98eLe9hMJDRuLWcTHDqWJ0OvnV2ppQVDt4m/T2zfluWBbZYk46NjXkAde9rjsfK9Reg=
after_success:
  - echo "$DOCKER_EMAIL"
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build -f thumbor/Dockerfile -t apsl/thumbor:$COMMIT thumbor/
  - docker tag apsl/thumbor:$COMMIT apsl/thumbor:$TAG
  - docker tag apsl/thumbor:$COMMIT apsl/thumbor:travis-$TRAVIS_BUILD_NUMBER
  - docker push apsl/thumbor
  - docker build -f thumbor-multiprocess/Dockerfile -t apsl/thumbor:$COMMIT thumbor-multiprocess/
  - docker tag apsl/thumbor-multiprocess:$COMMIT apsl/thumbor-multiprocess:$TAG
  - docker tag apsl/thumbor:$COMMIT apsl/thumbor-multiprocess:travis-$TRAVIS_BUILD_NUMBER
  - docker push apsl/thumbor-multiprocess
  - docker build -f nginx/Dockerfile -t apsl/thumbor-nginx:$COMMIT nginx/
  - docker tag apsl/thumbor-nginx:$COMMIT apsl/thumbor-nginx:$TAG
  - docker tag apsl/thumbor-nginx:$COMMIT apsl/thumbor-nginx:travis-$TRAVIS_BUILD_NUMBER
  - docker push apsl/thumbor-nginx
  - docker build -f remotecv/Dockerfile -t apsl/thumbor-nginx:$COMMIT remotecv/
  - docker tag apsl/remotecv:$COMMIT apsl/remotecv:$TAG
  - docker tag apsl/remotecv:$COMMIT apsl/remotecv:travis-$TRAVIS_BUILD_NUMBER
  - docker push apsl/remotecv
