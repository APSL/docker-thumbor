version: '2'
services:

  imageserver:
    image: python:3
    ports:
      - "127.0.0.1:8080:8000"
    volumes:
      - ./tests/images/v1:/data
    command: ["python3", "-m",  "http.server", "--directory=/data"]
    networks:
      - app

  thumbor:
    build: thumbor
    env_file: env
    volumes:
      - data:/data
    links:
      - redis:redis
    networks:
      - app

  nginx:
    build: nginx
    links:
      - thumbor:thumbor
    env_file: env
    volumes_from:
      - thumbor
    ports:
      - "8169:8000"
    hostname: nginx
    networks:
      - app

  redis:
    image: redis:latest
    networks:
      - app


volumes:
  data:
    driver: local

networks:
  app:
    driver: bridge
